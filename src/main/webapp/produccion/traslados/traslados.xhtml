<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template/catalog-template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:pe="http://primefaces.org/ui/extensions">
  <ui:param name="controller" value="#{traspasoController}"/>
  <ui:param name="rowkey" value="#{entity.idTraspaso}"/>
  <ui:param name="datosTabTitle" value="Traslados"/>
  <ui:param name="formLegend" value="Traslado"/>

  <ui:define name="toolbar-extra-btn">
    <p:commandButton value="Enviar" action="#{traspasoController.enviarTraspaso}"
                     disabled="#{empty traspasoController.selection}" ajax="true"
                     update="pnlCrud:frmDatatable:dtDatatable"
                     rendered="#{traspasoController.selection.estado eq 'P'}"/>
    <p:commandButton value="Recibir" action="#{traspasoController.recibirTraspaso}"
                     disabled="#{empty traspasoController.selection}" ajax="true"
                     update="pnlCrud:frmDatatable:dtDatatable"
                     rendered="#{traspasoController.selection.estado eq 'E'}"/>
    <!--        <p:commandButton value="Liberar" icon="ui-icon-btn-apply" action="#{ordenProduccion3Controller.liberarOrden()}"-->
    <!--                         disabled="#{empty ordenProduccion3Controller.selection or ordenProduccion3Controller.selection.estado eq 'L'}"-->
    <!--                         update="dtDatatable" rendered="#{usuarioController.admin}">-->
    <!--            <p:confirm message="¿Desea liberar la orden seleccionada?"/>-->
    <!--        </p:commandButton>-->
    <!--        <p:commandButton value="Revertir Estado" action="#{ordenProduccion3Controller.revertirEstado()}"-->
    <!--                         disabled="#{empty ordenProduccion3Controller.selection}"-->
    <!--                         update="pnlCrud:frmDatatable:dtDatatable" rendered="#{usuarioController.admin}">-->
    <!--            <p:confirm message="¿Desea revertir el estado de la orden?"/>-->
    <!--        </p:commandButton>-->
    <!--        &lt;!&ndash;<p:commandButton value="Generar Asiento" action="#{ordenProduccion3Controller.generarAsiento()}" disabled="#{empty ordenProduccion3Controller.selection}" rendered="#{usuarioController.admin}"/>&ndash;&gt;-->
    <!--        <p:commandButton value="Imprimir Etiquetas" action="#{ordenProduccion3Controller.generarEtiquetas()}"-->
    <!--                         disabled="#{empty ordenProduccion3Controller.selection}" ajax="false"/>-->
    <!--        <p:commandButton value="Imprimir Etiquetas (Langosta)"-->
    <!--                         action="#{ordenProduccion3Controller.generarEtiquetasLobster()}"-->
    <!--                         disabled="#{empty ordenProduccion3Controller.selection || ordenProduccion3Controller.selection.fresco}"-->
    <!--                         ajax="false"/>-->
    <!--<p:commandButton value="Fix Trans." action="#{ordenProduccion3Controller.fixTransacciones()}" disabled="#{empty ordenProduccion3Controller.selection}" ajax="false"/>-->

    <!--<p:commandButton value="Consumo" action="#{ordenProduccion3Controller.consumir()}" update="pnlCrud" disabled="#{empty ordenProduccion3Controller.selection}"/>
    <p:commandButton value="Aplicar Trans. Consumo" title="Aplicar Transacciones de Consumo" action="#{ordenProduccion3Controller.aplicarTrans()}" update="pnlCrud" disabled="#{empty ordenProduccion3Controller.selection}"/>
    <p:commandButton value="Aplicar Trans. PT" title="Aplicar Transacciones de Producto Terminado" action="#{ordenProduccion3Controller.viewAplicarTransEntrada()}" update="pnlCrud" disabled="#{empty ordenProduccion3Controller.selection or ordenProduccion3Controller.selection.transAplicada eq 'S'}"/>
    -->
    <!--<p:commandButton value="Calcular" icon="ui-icon-btn-calculate" disabled="#{empty ordenProduccion3Controller.selection or ordenProduccion3Controller.selection.estado ne 'P'}"/>-->
  </ui:define>

  <ui:define name="table-multiple"/>

  <!--    <ui:define name="table-form">-->
  <!--        <p:selectBooleanCheckbox itemLabel="Mostrar liberados" label="Mostrar liberados"-->
  <!--                                 value="#{ordenProduccion3Controller.mostrarLiberados}">-->
  <!--            <p:ajax update="pnlCrud:frmDatatable:dtDatatable" listener="#{ordenProduccion3Controller.cargarLista()}"/>-->
  <!--        </p:selectBooleanCheckbox>-->
  <!--    </ui:define>-->

  <ui:define name="table-body">
    <p:column headerText="# Traslado" sortBy="#{entity.n_Traspaso}" filterBy="#{entity.n_Traspaso}">
      <h:outputText value="#{entity.n_Traspaso}"/>
    </p:column>
    <p:column headerText="Bodega origen" sortBy="#{entity.bodegaOrigen}" filterBy="#{entity.bodegaOrigen.bodega}">
      <h:outputText value="#{entity.bodegaOrigen.nombre}"/>
    </p:column>
    <p:column headerText="Bodega destino" sortBy="#{entity.bodegaDestino}"
              filterBy="#{entity.bodegaDestino.bodega}">
      <h:outputText value="#{entity.bodegaDestino.nombre}"/>
    </p:column>
    <p:column headerText="Estado" sortBy="#{entity.estadoTraslado.descripcion}"
              filterBy="#{entity.estadoTraslado.descripcion}">
      <h:outputText value="#{entity.estadoTraslado.descripcion}"/>
    </p:column>
    <!--        <p:column headerText="Artículo" sortBy="#{entity.articulo.articulo}" filterBy="#{entity.articulo.articulo}" >
                <h:outputText value="#{entity.articulo.articulo}"/>
            </p:column>
            <p:column headerText="Descripción" sortBy="#{entity.articulo.descripcion}" filterBy="#{entity.articulo.descripcion}" >
                <h:outputText value="#{entity.articulo.descripcion}"/>
            </p:column>-->
    <!--        <p:column headerText="Tipo" sortBy="#{entity.fresco}" filterBy="#{entity.fresco ? 'Fresco' : 'Congelado'}">-->
    <!--            <h:outputText value="#{entity.fresco ? 'Fresco' : 'Congelado'}"/>-->
    <!--        </p:column>-->
    <p:column headerText="Fecha de Creación" sortBy="#{entity.fechaCreacion}" filterBy="#{entity.fechaCreacion}"
              style="text-align: right">
      <h:outputText value="#{entity.fechaCreacion}">
        <f:convertDateTime pattern="dd/MM/yyyy"/>
      </h:outputText>
    </p:column>
    <p:column headerText="Fecha" sortBy="#{entity.fechaTraspaso}" filterBy="#{entity.fechaTraspaso}"
              style="text-align: right">
      <h:outputText value="#{entity.fechaTraspaso}">
        <f:convertDateTime pattern="dd/MM/yyyy"/>
      </h:outputText>
    </p:column>
    <!--        <p:column headerText="Estado" sortBy="#{entity.estadoProd.descripcion}"-->
    <!--                  filterBy="#{entity.estadoProd.descripcion}">-->
    <!--            <h:outputText value="#{entity.estadoProd.descripcion}"/>-->
    <!--        </p:column>-->
    <!--        &lt;!&ndash;<p:column headerText="Fecha Creación" sortBy="#{entity.fechaCreacion}" filterBy="#{entity.fechaCreacion}">-->
    <!--            <h:outputText value="#{entity.fechaCreacion}">-->
    <!--                <f:convertDateTime pattern="dd/MM/yyyy hh:mm a"/>-->
    <!--            </h:outputText>-->
    <!--        </p:column>&ndash;&gt;-->
    <!--        <p:column headerText="Fecha de Liberación" sortBy="#{entity.fechaLiberacion}"-->
    <!--                  filterBy="#{entity.fechaLiberacion}">-->
    <!--            <h:outputText value="#{entity.fechaLiberacion}">-->
    <!--                <f:convertDateTime pattern="dd/MM/yyyy hh:mm a"/>-->
    <!--            </h:outputText>-->
    <!--        </p:column>-->
    <!--        <p:column headerText="Asiento Alinsa" sortBy="#{entity.asientoAlinsa}" filterBy="#{entity.asientoAlinsa}">-->
    <!--            <h:outputText value="#{entity.asientoAlinsa}"/>-->
    <!--        </p:column>-->
    <!--        <p:column headerText="Asiento Bcfoods" sortBy="#{entity.asientoBcfoods}" filterBy="#{entity.asientoBcfoods}">-->
    <!--            <h:outputText value="#{entity.asientoBcfoods}"/>-->
    <!--        </p:column>-->
  </ui:define>

  <ui:define name="form-body">
    <div class="form-group">
      <div class="row">
        <div class="col-sm-2">
          <p:outputLabel value="Traspaso" for="idTraspaso"/>
          <p:inputText id="idTraspaso" class="form-control"
                       value="#{traspasoController.entity.n_Traspaso}" readonly="true"/>
        </div>
        <div class="col-sm-2">
          <p:outputLabel value="Bodega Origen" for="somBodegaOrigen"/>
          <p:selectOneMenu id="somBodegaOrigen" disabled="#{traspasoController.areLineasRecepRendered()}"
                           converter="#{bodegaConverter}"
                           filterMatchMode="contains" filter="true" class="form-control"
                           value="#{traspasoController.entity.bodegaOrigen}" required="true">
            <p:ajax update="idTraspaso" listener="#{traspasoController.onBodegaOrigenChanged()}"/>
            <f:selectItem itemValue="" itemLabel="Seleccione..."/>
            <f:selectItems value="#{traspasoController.bodegas}" var="bodega"
                           itemValue="#{bodega}">
            </f:selectItems>
          </p:selectOneMenu>
        </div>
        <div class="col-sm-2">
          <p:outputLabel value="Bodega Destino" for="somBodegaDestino"/>
          <p:selectOneMenu id="somBodegaDestino" disabled="#{traspasoController.areLineasRecepRendered()}"
                           converter="#{bodegaConverter}"
                           filterMatchMode="contains" filter="true" class="form-control"
                           value="#{traspasoController.entity.bodegaDestino}" required="true">
            <f:selectItem itemValue="" itemLabel="Seleccione..."/>
            <f:selectItems value="#{traspasoController.bodegas}" var="bodega"
                           itemValue="#{bodega}">
            </f:selectItems>
          </p:selectOneMenu>
        </div>
        <div class="col-sm-3">
          <p:outputLabel value="Fecha" for="calFechaFin"/>
          <p:calendar id="calFechaFin" disabled="#{traspasoController.areLineasRecepRendered()}"
                      value="#{traspasoController.entity.fechaTraspaso}"
                      pattern="dd/MM/yyyy" navigator="true" required="true"/>
        </div>
      </div>
    </div>
    <p:accordionPanel id="pnlAccordion" dynamic="true" cache="false">
      <p:tab title="Embarques">
        <p:outputPanel class="form-group">
          <div class="row">
            <p:outputPanel id="pnlEmbarque">
              <div class="col-sm-6">
                <p:outputLabel value="Embarque" for="txtEmbarque"/>
                <p:inputText id="txtEmbarque"
                             value="#{traspasoController.selectedEmbarquesText()}"
                             readonly="true" class="form-control dblclick"
                             ondblclick="PF('wvDlgEmbarque').show()"
                             disabled="#{traspasoController.areLineasRecepRendered()}"/>
              </div>
              <!--              <p:outputPanel class="col-sm-6" rendered="#{ordenCompraController.fresco}">-->
              <!--                <p:outputLabel value="Producto Terminado" for="txtProductoTerminado"/>-->
              <!--                <p:inputText id="txtProductoTerminado"-->
              <!--                             value="#{ordenCompraController.productoTerminado.articuloDesc}"-->
              <!--                             readonly="true" class="form-control dblclick"-->
              <!--                             ondblclick="PF('wvDlgProductosTerminados').show()"/>-->
              <!--              </p:outputPanel>-->
              <div class="col-sm-2">
                <br/>
                <p:commandButton id="btnAgregar" value="Agregar"
                                 disabled="#{traspasoController.areLineasRecepRendered()}"
                                 action="#{traspasoController.agregarEmbarque()}"
                                 partialSubmit="true" update="pnlEmbarques pnlLineas" class="btn btn-agregar-pesada"/>
              </div>
            </p:outputPanel>
          </div>
        </p:outputPanel>

        <div class="row">
          <div class="col col-md-6">
            <p:outputPanel id="pnlEmbarques">
              <p:dataTable var="embarque" value="#{traspasoController.addedEmbarques}" rowKey="#{embarque.embarque}"
                           editable="true" editMode="cell">
                <p:column headerText="Embarque" sortBy="#{embarque.embarque}">
                  <h:outputText value="#{embarque.embarque}"/>
                </p:column>
                <p:column headerText="Fecha Embarque" sortBy="#{embarque.fecha_Embarque}">
                  <h:outputText value="#{embarque.fecha_Embarque}">
                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                  </h:outputText>
                </p:column>
              </p:dataTable>
            </p:outputPanel>
          </div>
        </div>
      </p:tab>
      <p:tab title="Lineas para Envio">
        <p:outputPanel id="pnlLineas">
          <p:dataTable value="#{traspasoController.entity.lineasEnvio}" var="linea">
            <p:column headerText="Artículo">
              <h:outputText value="#{linea.articulo.articulo}"/>
            </p:column>
            <p:column headerText="Descripción">
              <h:outputText value="#{linea.articulo.descripcion}"/>
            </p:column>
            <p:column headerText="Lote">
              <h:outputText value="#{linea.lote}"/>
            </p:column>
            <p:column headerText="Cantidad">
              <h:outputText value="#{linea.cantidad}">
                <f:convertNumber pattern="#0.00"></f:convertNumber>
              </h:outputText>
            </p:column>
            <p:column headerText="Precio unitario">
              <h:outputText value="#{linea.precio_Unitario}">
                <f:convertNumber pattern="#0.00"></f:convertNumber>
              </h:outputText>
            </p:column>

          </p:dataTable>
        </p:outputPanel>
      </p:tab>
      <p:tab title="Lineas de recepcion" rendered="#{traspasoController.areLineasRecepRendered()}">
        <p:outputPanel class="form-group">
          <div class="row">
            <p:outputPanel id="pnlLineasRecepcionForm">
              <div class="col-sm-3">
                <p:outputLabel value="Articulo" for="txtArticulo"/>
                <p:inputText id="txtArticulo"
                             value="#{traspasoController.selectedArticuloRecepForm.articulo}"
                             readonly="true" class="form-control dblclick"
                             ondblclick="PF('wvDlgArticulos').show()"/>
              </div>
              <div class="col-sm-3">
                <p:outputLabel value="Peso" for="txtPesoRecepForm"/>
                <pe:inputNumber id="txtPesoRecepForm" value="#{traspasoController.cantidadArticuloRecepForm}"
                                class="form-control" required="false" decimalSeparator="." thousandSeparator=","/>
              </div>
<!--              <div class="col-sm-3">-->
              <!--                <p:outputLabel value="Precio" for="txtPrecioRecepForm"/>-->
              <!--                <pe:inputNumber id="txtPrecioRecepForm" value="#{traspasoController.precioArticuloRecepForm}"-->
              <!--                                class="form-control" required="false" decimalSeparator="." thousandSeparator=","/>-->
              <!--              </div>-->
              <!--              <p:outputPanel class="col-sm-6" rendered="#{ordenCompraController.fresco}">-->
              <!--                <p:outputLabel value="Producto Terminado" for="txtProductoTerminado"/>-->
              <!--                <p:inputText id="txtProductoTerminado"-->
              <!--                             value="#{ordenCompraController.productoTerminado.articuloDesc}"-->
              <!--                             readonly="true" class="form-control dblclick"-->
              <!--                             ondblclick="PF('wvDlgProductosTerminados').show()"/>-->
              <!--              </p:outputPanel>-->
              <div class="col-sm-2">
                <br/>
                <p:commandButton id="btnAgregarLineaRecep" value="Agregar"
                                 action="#{traspasoController.agregarLineaRecepcion()}"
                                 ajax="true"
                                 disabled="#{traspasoController.entity.estado eq 'R'}"
                                 update="pnlCrud:frmForm:pnlAccordion:pnlLineasRecepcionForm,pnlCrud:frmForm:pnlAccordion:pnlLineasRecep"
                                 class="btn btn-agregar-pesada"/>
              </div>
              <div class="col-sm-2">
                <br/>
                <p:commandButton id="btnSugerirLineas" value="Sugerir Lineas"
                                 action="#{traspasoController.sugerirLineas()}"
                                 ajax="true"
                                 disabled="#{traspasoController.entity.estado eq 'R'}"
                                 update="pnlCrud:frmForm:pnlAccordion:pnlLineasRecepcionForm,pnlCrud:frmForm:pnlAccordion:pnlLineasRecep"
                                 class="btn btn-agregar-pesada"/>
              </div>
            </p:outputPanel>
          </div>
        </p:outputPanel>
        <p:outputPanel id="pnlLineasRecep">
          <p:dataTable id="dtLineasRecep" value="#{traspasoController.entity.lineasRecepcion}" var="linea"
                       editable="#{traspasoController.entity.estado eq 'E'}" editMode="cell">
            <p:column style="width:48px">
              <p:commandLink action="#{traspasoController.quitarLineaRecepcion(linea)}" title="Quitar"
                             update="dtLineasRecep" ajax="true">
                <p:graphicImage value="/resources/images/delete.png"/>
              </p:commandLink>
            </p:column>
            <p:column headerText="Artículo">
              <h:outputText value="#{linea.articulo.articulo}"/>
            </p:column>
            <p:column headerText="Descripción">
              <h:outputText value="#{linea.articulo.descripcion}"/>
            </p:column>
            <p:column headerText="Lote">
              <h:outputText value="#{linea.lote}"/>
            </p:column>
            <p:column headerText="Cantidad">
              <p:cellEditor>
                <f:facet name="output">
                  <h:outputText value="#{linea.cantidad}">
                    <f:convertNumber pattern="#,##0.00" locale="es-NI"/>
                  </h:outputText>
                </f:facet>
                <f:facet name="input">
                  <input type="number" jsf:value="#{linea.cantidad}" class="form-control"/>
                </f:facet>
              </p:cellEditor>
            </p:column>
            <p:column headerText="Precio unitario">
              <h:outputText value="#{linea.precio_Unitario}">
                <f:convertNumber pattern="#0.00"></f:convertNumber>
              </h:outputText>
            </p:column>

          </p:dataTable>
        </p:outputPanel>
      </p:tab>
    </p:accordionPanel>

    <p:dialog id="dlgEmbarques" widgetVar="wvDlgEmbarque" responsive="true" position="top" modal="true">
      <p:dataTable id="dtEmbarques" value="#{traspasoController.embarques}" var="embarque"
                   rowKey="#{embarque.embarque}"
                   selectionMode="multiple" selection="#{traspasoController.selectedEmbarques}" rows="10"
                   paginator="true">
        <!--        <p:ajax event="rowSelect" update="pnlCrud:frmForm:pnlAccordion:pnlEmbarque"-->
        <!--                oncomplete="PF('wvDlgEmbarque').hide()"/>-->
        <p:column headerText="Embarque" sortBy="#{embarque.embarque}" filterBy="#{embarque.embarque}">
          <h:outputText value="#{embarque.embarque}"/>
        </p:column>
        <p:column headerText="Fecha Embarque" sortBy="#{embarque.fecha_Embarque}" filterBy="#{embarque.fecha_Embarque}">
          <h:outputText value="#{embarque.fecha_Embarque}">
            <f:convertDateTime pattern="dd/MM/yyyy"/>
          </h:outputText>
        </p:column>
      </p:dataTable>
      <p:commandButton class="btn btn-agregar-pesada" update="pnlCrud:frmForm:pnlAccordion:pnlEmbarque" ajax="true"
                       value="Seleccionar" oncomplete="PF('wvDlgEmbarque').hide()"/>
    </p:dialog>
    <p:dialog id="dlgArticulos" widgetVar="wvDlgArticulos" responsive="true" position="top" modal="true">
      <p:dataTable id="dtArticulos" value="#{traspasoController.articulosMP}" var="articulo"
                   rowKey="#{articulo.articulo}"
                   selectionMode="single" selection="#{traspasoController.selectedArticuloRecepForm}"
                   rows="10" paginator="true">
        <p:ajax event="rowSelect"
                update="pnlCrud:frmForm:pnlAccordion:pnlLineasRecepcionForm"
                oncomplete="PF('wvDlgArticulos').hide()"/>
        <!--,pnlCrud:frmForm:dtPedidos-->
        <p:column headerText="Artículo" sortBy="#{articulo.articulo}" filterBy="#{articulo.articulo}">
          <h:outputText value="#{articulo.articulo}"/>
        </p:column>
        <p:column headerText="Descripción" sortBy="#{articulo.descripcion}"
                  filterBy="#{articulo.descripcion}" filterMatchMode="contains">
          <h:outputText value="#{articulo.descripcion}"/>
        </p:column>
      </p:dataTable>
    </p:dialog>
  </ui:define>
</ui:composition>